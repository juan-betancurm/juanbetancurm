---
import Layout from "../layouts/Layout.astro";
import { getCollection } from "astro:content";
import BottomLayout from "src/layouts/BottomLayout.astro";
import TopLayout from "src/layouts/TopLayout.astro";
import { WORK } from "src/consts";
import PageTransition from "src/components/PageTransition.astro";

const collection = await getCollection("work");

collection.sort(
	(a, b) =>
		new Date(b.data.dateStart).getTime() - new Date(a.data.dateStart).getTime(),
);

const work = await Promise.all(
	collection.map(async (item) => {
		const { Content } = await item.render();
		return { ...item, Content };
	}),
);

function formatWorkDate(input: Date | string) {
	if (typeof input === "string") return input;

	const month = input.toLocaleDateString("en-US", {
		month: "short",
	});

	const year = new Date(input).getFullYear();
	return `${month} ${year}`;
}
---

<Layout title={WORK.TITLE} description={WORK.DESCRIPTION}>
	<PageTransition duration="1s" delay="0.2s">
	<TopLayout>
		<div class="animate page-heading">
			{WORK.TITLE}
		</div>
	</TopLayout>
	<BottomLayout>
		<ul>
			{
				work.map((entry) => (
					<li class="border-b border-black/10 mt-4 py-8 first-of-type:mt-0 first-of-type:pt-0 last-of-type:border-none">
						<div class="text-sm uppercase mb-4">
							{formatWorkDate(entry.data.dateStart)} -{" "}
							{formatWorkDate(entry.data.dateEnd)}
						</div>
						<div class="text-black font-semibold">{entry.data.company}</div>
						<div class="text-sm font-semibold">{entry.data.role}</div>
						<article class="prose">
							<entry.Content />
						</article>
					</li>
				))
			}
		</ul>
	</BottomLayout>
	</PageTransition>
</Layout>
